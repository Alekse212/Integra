<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Local - Integra</title>
    <link rel="stylesheet" type="text/css" href="/public/css/Local.css">
    <script src="/public/script/Principal.js"></script>
    <link rel="icon" href="/public/favicon.ico" type="image/x-icon">
</head>
<body>
    <header>
        <div>
            <div class="component-container">
                <span class="component-text"><a href="/"><span>INTEGRA</span></a></span>
            </div>
        </div>
        <nav>
            <ul>
                <li><a href="/public/Vivienda">Vivienda</a></li>
                <li><a href="/public/Local">Locales</a></li>
                <li><a href="/public/Terrenos">Terrenos</a></li>
                <li><a href="/public/Servicios">Servicios</a></li>
                <li><a href="/public/Contactos">Contacto</a></li>
            </ul>
        </nav>
    </header>
<main>
    <img src="/public/images/image/local.jpg"alt="" class="Localfon">
    <div class="filter">
        <div class="filter">
            <form action="/private/Local" method="get">
                <input type="text" name="cuidad" placeholder="Cuidad" >
                <input type="number" name="minPrice" placeholder="Precio min" >
                <input type="number" name="maxPrice" placeholder="Precio max" >
                <input type="number" name="tamanoMin" placeholder="Min tamano" >
                <input type="number" name="tamanoMax" placeholder="Max tamano" >
                <input type="number" name="bano" placeholder="Banos">
                <input type="date" name="fechadeintroduccion" placeholder="fechadeintroduccion">
                <select name="tipo" id="tipo">
                    <option value="" disabled selected>Tipo</option>
                    <option value="" selected></option>
                    <option th:each="tipo : ${T(com.example.Integra.models.enumeration.TipoLocal).values()}" th:value="${tipo}" th:text="${tipo.getDisplayName()}"></option>
                </select>
                <select name="opcion" id="opcion">
                    <option value="" disabled selected>Opcion</option>
                    <option value="Venta" selected>Venta</option>
                    <option value="Alquiler">Alquiler</option>
                    <option value="Traspaso">Traspaso</option>
                </select>
                <button type="button" id="filterButton">Filtrar</button>
                <button type="button" id="resetFiltersButton">Restablecer</button>
            </form>
        </div>
    </div>
    <div class="Local">

        <div th:each="local : ${local}" class="Local-block">
            <a href="#" th:data-id="${local.id}" onclick="redirectCardLoc(this.getAttribute('data-id'))">
                <div class="none_decor">
                    <img class="card-preview-img"  th:src="@{/public/imagesVivienda/{imageName}(imageName=${local.previewImage})}" />
                    <div class="card-precio">
                        <span th:text="${local.precio}">20000</span><span>€</span></br>
                    </div>
                    <h2 th:text="${local.titulo}">Titulo</h2>
                    <div class="card-img-top">
                        <div class="card-cuidad">
                            <img src="/public/images/image/city.png"alt="">
                            <span th:text="${local.cuidad}">Guardama del Segura</span></br>
                        </div>
                        <div class="card-bath">
                            <img src="/public/images/image/bath.png" alt=""></span>
                            <span th:text="${local.bano}">2</span>
                        </div>
                        <div class="card-tamano">
                            <img src="/public/images/image/Plan.png" alt="">
                            <span><span th:text="${local.tamano}">200</span><span>m<sup>2</sup></span></span>
                        </div>

                    </div>
                </div>
            </a>
        </div>
    </div>
</main>
<footer class="component1-footer">
    <div class="component1-container1">
        <h2>Integra</h2>
        <div class="component1-text">
            <span>© 2023 Integra,</span>
            <br />
            <span>All Rights Reserved.</span>
            <span class="component1-text04"></span>
            <span></span>
        </div>
        <div class="component1-icon-group">
            <svg viewBox="0 0 950.8571428571428 1024" class="component1-icon">
                <path
                        d="M925.714 233.143c-25.143 36.571-56.571 69.143-92.571 95.429 0.571 8 0.571 16 0.571 24 0 244-185.714 525.143-525.143 525.143-104.571 0-201.714-30.286-283.429-82.857 14.857 1.714 29.143 2.286 44.571 2.286 86.286 0 165.714-29.143 229.143-78.857-81.143-1.714-149.143-54.857-172.571-128 11.429 1.714 22.857 2.857 34.857 2.857 16.571 0 33.143-2.286 48.571-6.286-84.571-17.143-148-91.429-148-181.143v-2.286c24.571 13.714 53.143 22.286 83.429 23.429-49.714-33.143-82.286-89.714-82.286-153.714 0-34.286 9.143-65.714 25.143-93.143 90.857 112 227.429 185.143 380.571 193.143-2.857-13.714-4.571-28-4.571-42.286 0-101.714 82.286-184.571 184.571-184.571 53.143 0 101.143 22.286 134.857 58.286 41.714-8 81.714-23.429 117.143-44.571-13.714 42.857-42.857 78.857-81.143 101.714 37.143-4 73.143-14.286 106.286-28.571z"
                ></path></svg
            ><svg viewBox="0 0 877.7142857142857 1024" class="component1-icon2">
            <path
                    d="M585.143 512c0-80.571-65.714-146.286-146.286-146.286s-146.286 65.714-146.286 146.286 65.714 146.286 146.286 146.286 146.286-65.714 146.286-146.286zM664 512c0 124.571-100.571 225.143-225.143 225.143s-225.143-100.571-225.143-225.143 100.571-225.143 225.143-225.143 225.143 100.571 225.143 225.143zM725.714 277.714c0 29.143-23.429 52.571-52.571 52.571s-52.571-23.429-52.571-52.571 23.429-52.571 52.571-52.571 52.571 23.429 52.571 52.571zM438.857 152c-64 0-201.143-5.143-258.857 17.714-20 8-34.857 17.714-50.286 33.143s-25.143 30.286-33.143 50.286c-22.857 57.714-17.714 194.857-17.714 258.857s-5.143 201.143 17.714 258.857c8 20 17.714 34.857 33.143 50.286s30.286 25.143 50.286 33.143c57.714 22.857 194.857 17.714 258.857 17.714s201.143 5.143 258.857-17.714c20-8 34.857-17.714 50.286-33.143s25.143-30.286 33.143-50.286c22.857-57.714 17.714-194.857 17.714-258.857s5.143-201.143-17.714-258.857c-8-20-17.714-34.857-33.143-50.286s-30.286-25.143-50.286-33.143c-57.714-22.857-194.857-17.714-258.857-17.714zM877.714 512c0 60.571 0.571 120.571-2.857 181.143-3.429 70.286-19.429 132.571-70.857 184s-113.714 67.429-184 70.857c-60.571 3.429-120.571 2.857-181.143 2.857s-120.571 0.571-181.143-2.857c-70.286-3.429-132.571-19.429-184-70.857s-67.429-113.714-70.857-184c-3.429-60.571-2.857-120.571-2.857-181.143s-0.571-120.571 2.857-181.143c3.429-70.286 19.429-132.571 70.857-184s113.714-67.429 184-70.857c60.571-3.429 120.571-2.857 181.143-2.857s120.571-0.571 181.143 2.857c70.286 3.429 132.571 19.429 184 70.857s67.429 113.714 70.857 184c3.429 60.571 2.857 120.571 2.857 181.143z"
            ></path></svg
        ><svg viewBox="0 0 602.2582857142856 1024" class="component1-icon4">
            <path
                    d="M548 6.857v150.857h-89.714c-70.286 0-83.429 33.714-83.429 82.286v108h167.429l-22.286 169.143h-145.143v433.714h-174.857v-433.714h-145.714v-169.143h145.714v-124.571c0-144.571 88.571-223.429 217.714-223.429 61.714 0 114.857 4.571 130.286 6.857z"
            ></path>
        </svg>
        </div>
    </div>

    <div class="component1-links-container">
        <div class="component1-container2">
            <span class="component1-text06">Navegación</span>
            <span class="component1-text07"><a href="/">Inicio</a></span>
            <span class="component1-text08"><a href="/#descripcion">Quienes somos</a></span>
            <span class="component1-text09"><a href ="#" onclick="redirectVivienda()">Viviendas</a></span>
            <span class="component1-text31"><a href ="#" onclick="redirectTerrenos()">Terrenos</a></span>
            <span class="component1-text32"><a href="/public/Servicios">Servicios</a></span>
            <span class="component1-text31"><a href ="#" onclick="redirectLocal()">Locales</a></span>

        </div>
        <div class="component1-container5">
            <div class="component1-container6">
                <span class="component1-text11"><a href="/public/CondicionesDeUso">Condiciones de Uso</a></span>
                <span class="component1-text12"><a href="/public/PoliticaPrivasidad">Política de Privacidad</a></span>
                <span class="component1-text13"><a href="#" onclick="openLoginPopup()">Acceso empleados</a></span>
            </div>
        </div>
    </div>


</footer>
<div id="loginPopup" class="popup">
    <div class="popup-content">
        <!-- Форма входа -->
        <form action="" class="form_main">
            <p class="heading">Login</p>
            <div class="inputContainer">
                <svg class="inputIcon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#2e2e2e" viewBox="0 0 16 16">
                <path d="M13.106 7.222c0-2.967-2.249-5.032-5.482-5.032-3.35 0-5.646 2.318-5.646 5.702 0 3.493 2.235 5.708 5.762 5.708.862 0 1.689-.123 2.304-.335v-.862c-.43.199-1.354.328-2.29.328-2.926 0-4.813-1.88-4.813-4.798 0-2.844 1.921-4.881 4.594-4.881 2.735 0 4.608 1.688 4.608 4.156 0 1.682-.554 2.769-1.416 2.769-.492 0-.772-.28-.772-.76V5.206H8.923v.834h-.11c-.266-.595-.881-.964-1.6-.964-1.4 0-2.378 1.162-2.378 2.823 0 1.737.957 2.906 2.379 2.906.8 0 1.415-.39 1.709-1.087h.11c.081.67.703 1.148 1.503 1.148 1.572 0 2.57-1.415 2.57-3.643zm-7.177.704c0-1.197.54-1.907 1.456-1.907.93 0 1.524.738 1.524 1.907S8.308 9.84 7.371 9.84c-.895 0-1.442-.725-1.442-1.914z"></path>
                </svg>
            <input type="text" class="inputField" id="email" placeholder="Username">
            </div>
            
        <div class="inputContainer">
            <svg class="inputIcon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="#2e2e2e" viewBox="0 0 16 16">
            <path d="M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z"></path>
            </svg>
            <input type="password" class="inputField" id="password" placeholder="Password">
        </div>
                      
        <a href="#" onclick="logoutUser()">Salir</a>
        <button id="button" onclick="authenticateUser()">Entrar</button>
        </form>
        
        <!-- Добавьте кнопку закрытия окна -->
        <span class="close" onclick="closeLoginPopup()">&times;</span>
    </div>
</div>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        // Находим кнопку "Применить фильтр" по ID
        const filterButton = document.getElementById("filterButton");

        // Находим кнопку "Сбросить фильтры" по ID
        const resetFiltersButton = document.getElementById("resetFiltersButton");

        // Добавляем обработчик клика на кнопку "Применить фильтр"
        filterButton.addEventListener("click", redirectToFilteredVivienda);

        // Добавляем обработчик клика на кнопку "Сбросить фильтры"
        resetFiltersButton.addEventListener("click", resetFilters);

        // Заполняем поля фильтра значениями из URL при первой загрузке страницы
        populateFilterFields();
    });


    function resetFilters() {
    document.querySelector('input[name="cuidad"]').value = "";
    document.querySelector('input[name="minPrice"]').value = "";
    document.querySelector('input[name="maxPrice"]').value = "";
    document.querySelector('input[name="tamanoMin"]').value = "";
    document.querySelector('input[name="tamanoMax"]').value = "";
    document.querySelector('input[name="bano"]').value = "";
    document.querySelector('input[name="fechadeintroduccion"]').value = "";

    // Перенаправляем на страницу без параметров фильтрации
    const token = localStorage.getItem('token');
    window.location.href = `/public/Local`;
}
        function populateFilterFields() {
        const urlParams = new URLSearchParams(window.location.search);

        document.querySelector('input[name="cuidad"]').value = urlParams.get("cuidad") || "";
        document.querySelector('input[name="minPrice"]').value = urlParams.get("minPrice") || "";
        document.querySelector('input[name="maxPrice"]').value = urlParams.get("maxPrice") || "";
        document.querySelector('input[name="tamanoMin"]').value = urlParams.get("tamanoMin") || "";
        document.querySelector('input[name="tamanoMax"]').value = urlParams.get("tamanoMax") || "";
        document.querySelector('input[name="bano"]').value = urlParams.get("bano") || "";
        document.querySelector('input[name="fechadeintroduccion"]').value = urlParams.get("fechadeintroduccion") || "";
        document.querySelector('select[name="tipo"]').value = urlParams.get("tipo") || "";
        document.querySelector('select[name="opcion"]').value = urlParams.get("opcion") || "";

    }


        function redirectToFilteredVivienda() {

            // Получаем значения из полей формы
            const cuidadFilter = document.querySelector('input[name="cuidad"]').value.trim();
            const minPriceInput = document.querySelector('input[name="minPrice"]');
            const maxPriceInput = document.querySelector('input[name="maxPrice"]');
            const tamanoMinInput = document.querySelector('input[name="tamanoMin"]');
            const tamanoMaxInput = document.querySelector('input[name="tamanoMax"]');
            const banoInput = document.querySelector('input[name="bano"]');
            const fechadeintroduccionInput = document.querySelector('input[name="fechadeintroduccion"]');
            const estadoSelect = document.querySelector('select[name="estado"]');
            const fechadeintroduccionFilter = fechadeintroduccionInput.value;
            const tipoSelect = document.querySelector('select[name="tipo"]');
            const tipoFilter = tipoSelect.value;
            const opcionSelect = document.querySelector('select[name="opcion"]');
            const opcionFilter = opcionSelect.value;
            // Строим URL с фильтрами
            let filteredUrl = `/public/Local?`;
            // Преобразуем значения в числа, проверяем на NaN и задаем значения по умолчанию
            let minPriceFilter = parseFloat(minPriceInput.value);


            let maxPriceFilter = parseFloat(maxPriceInput.value);


            let tamanoMinFilter = parseInt(tamanoMinInput.value);


            let tamanoMaxFilter = parseInt(tamanoMaxInput.value);


            let banoFilter = parseInt(banoInput.value);


            if (cuidadFilter !== '') {
                filteredUrl += `&cuidad=${encodeURIComponent(cuidadFilter)}`;
            }
            if (!isNaN(minPriceFilter) && minPriceFilter >= 0) {
                filteredUrl += `&minPrice=${encodeURIComponent(minPriceFilter)}`;
            }
            if (!isNaN(maxPriceFilter) && maxPriceFilter >= 0) {
                filteredUrl += `&maxPrice=${encodeURIComponent(maxPriceFilter)}`;
            }
            if (!isNaN(tamanoMinFilter) && tamanoMinFilter >= 0) {
                filteredUrl += `&tamanoMin=${encodeURIComponent(tamanoMinFilter)}`;
            }
            if (!isNaN(tamanoMaxFilter) && tamanoMaxFilter >= 0) {
                filteredUrl += `&tamanoMax=${encodeURIComponent(tamanoMaxFilter)}`;
            }
            if (!isNaN(banoFilter) && banoFilter > 0) {
                filteredUrl += `&bano=${encodeURIComponent(banoFilter)}`;
            }
            if (fechadeintroduccionFilter.trim() !== '') {
                filteredUrl += `&fechadeintroduccion=${encodeURIComponent(fechadeintroduccionFilter)}`;
            }
            if (tipoFilter !== '') {
                filteredUrl += `&tipo=${encodeURIComponent(tipoFilter)}`;
            }
            if (opcionFilter !== '') {
                filteredUrl += `&opcion=${encodeURIComponent(opcionFilter)}`;
            }

            document.querySelector('input[name="cuidad"]').value = cuidadFilter;
            document.querySelector('input[name="minPrice"]').value = minPriceFilter;
            document.querySelector('input[name="maxPrice"]').value = maxPriceFilter;
            document.querySelector('input[name="tamanoMin"]').value = tamanoMinFilter;
            document.querySelector('input[name="tamanoMax"]').value = tamanoMaxFilter;
            document.querySelector('input[name="bano"]').value = banoFilter;
            document.querySelector('input[name="fechadeintroduccion"]').value = fechadeintroduccionFilter;
            document.querySelector('select[name="tipo"]').value = tipoFilter;
            document.querySelector('select[name="opcion"]').value = opcionFilter;


            // Redirect to the filtered URL
            window.location.href = filteredUrl;
        }


</script>
</body>
</html>

